Nice work finding the bugs and getting the tests to pass. 

See comments in *.c files.